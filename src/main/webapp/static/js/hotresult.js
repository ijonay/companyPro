var result={
        "data": [{
            "id": 1,
            "title": "#霍建华林心如结婚霍建华林心如结婚#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 70,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#王宝强离婚王宝强离婚王宝强离婚王宝强离婚王宝强离婚#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 85,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        }
        ,{
            "id": 2,
            "title": "#热点名称热点名称热点名称热点名称热点名称热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 95,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 65,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 75,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 82,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 79,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 15,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 35,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 10,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 1,
            "title": "#霍建华林心如结婚#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 70,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#王宝强离婚#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 85,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        }
        ,{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 95,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 65,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 75,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 82,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 79,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 15,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 35,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        },{
            "id": 2,
            "title": "#热点名称热点名称热点名称热点名称热点名称热点名称#",
            "score": 0.44,
            "coordinate": null,
            "logoUrl": null,
            "readNum": 10,
            "readNumTrendGrowth": null,
            "relationDesc": null,
            "topicUrl": null,
            "topicType": null
        }],
        "error": {
            "code": 0,
            "message": "成功"
        }
    }
$("<div type='text' class='word wordwidth'>关键字仅八个字…</div>").appendTo($("#canvas"));
drawWord(result.data);
function drawWord(data) {
    var pointArr = [];
    $.each(data, function(idx, item) {
        if(idx%2!=0){
            var r = 150 + (idx-1) * 16;
        }else{
            var r = 150 + idx * 16;
        }
        var fontClass = "fontClass1",
            sizeClass = "sizeClass1";
        if(item.readNum<= 50) {
            fontClass = "fontClass1";
            sizeClass = "sizeClass1";
        } else if(item.readNum<= 80) {
            fontClass = "fontClass2";
            sizeClass = "sizeClass2";
        } else if(item.readNum<= 90) {
            fontClass = "fontClass3";
            sizeClass = "sizeClass3";
        } else if(item.readNum<= 100) {
            fontClass = "fontClass4";
            sizeClass = "sizeClass4";
        }
        $item = $("<div class='topic'>" +
                "<span class='icon " + sizeClass + "'>"+item.readNum+"</span><span class='link " + fontClass + "'>" + item.title + "</span></div>").appendTo($("#canvas"));
        var itemWidth = $item.width();
        var itemHeight = $item.height();
        if(itemWidth > 180) {
            itemWidth = 180;
            $item.find(".link").css({
                "display": "block",
                "width": "180px"
            }).addClass("word-ellipsis");
        }
        var itemPos = checkao(idx, r, itemWidth, itemHeight, pointArr);
        pointArr.push({
            height: itemHeight,
            width: itemWidth,
            left: itemPos.left,
            top: itemPos.top
        });
        $item.css({
            "left": itemPos.left,
            "top": itemPos.top
        }).animate({
            "opacity": 1
        }, 300 + idx * 100);
    });
}
/*获得显示位置*/
function checkao(idx, r, itemWidth, itemHeight, pointArr) {
    var ao = 0;
    var elem = {
        width: itemWidth,
        height: itemHeight,
        left: 0,
        top: 0
    };
    do {
        if(idx % 2 == 0) {
            ao = (Math.floor(Math.random() * 10) % 2 == 0) ? Math.random() * (90 - 0 + 1) + 0 : Math.random() * (360 - 270 + 1) + 270;
        } else {
            ao = Math.random() * (270 - 90 + 1) + 90;
        }
        elem.left = 535 + r * Math.cos(ao * 3.14 / 180) - itemWidth / 2;
        elem.top = 238 + r * Math.sin(ao * 3.14 / 180) - itemHeight / 2;
    } while (hitTest(elem, pointArr) || elem.top + itemHeight > 476 || elem.top < 0)
    return elem;
}
/*检查重叠*/
function hitTest(elem, pointArr) {
    var overlapping = function(a, b) {
        if(Math.abs(2 * a.left + a.width - 2 * b.left - b.width) < a.width + b.width) {
            if(Math.abs(2 * a.top + a.height - 2 * b.top - b.height) < a.height + b.height) {
                return true;
            }
        }
        return false;
    };
    var i = 0;
    for(i = 0; i < pointArr.length; i++) {
        if(overlapping(elem, pointArr[i])) {
            return true;
        }
    }
    return false;
};
//hover事件
$(document).delegate('.topic','mouseover',function(){
    if($(this).find('.link').hasClass("word-ellipsis")){
        $(this).css("z-index","9").find('.link').removeClass("word-ellipsis").css({"width":"auto"});
        $(this).css("left",$(this).position().left-($(this).width()-180)/2)
    }
});

$(document).delegate('.topic','mouseout',function(){
    if($(this).find('.link').width()>180){
        $(this).css("left",$(this).position().left+($(this).width()-180)/2)
        $(this).css("z-index","0").find('.link').css("width","180px").addClass("word-ellipsis");
    }
});