(function(v,w){function u(a,c){for(var d=0;d<a.length;d++)if(a[d].toLowerCase()==c)return!0;return!1}function q(a){var c=a.data.index,d=a.data.ObjIds[c],e=$(this).attr("id"),b=$(this);KD.isNull(b.attr("name"))&&b.attr("name",e);var k=d.url,f=b.val().split("."),f=f[f.length-1].toLowerCase();if(!u(d.type,f))return alert("\u4ec5\u652f\u6301"+d.type+"\u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\uff01"),!1;var h="";try{h=b.prop("outerHTML")}catch(x){h=b.attr("outerHTML")}if(""==h)return alert("\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u9875\u9762\u91cd\u65b0\u4e0a\u4f20\uff01"),!1;var r=b.prev().length,l=null,l=0==r?b.parent():b.prev(),m="uploadIframe_"+e,f=null;0==$("#"+m).length&&(f=$('<iframe id="'+m+'" name="'+m+'" style="position:absolute; left:-9999px;  top :-9999px;"></iframe>'),$("body").children().eq(0).before(f));var t="?";-1<k.indexOf("?")&&(t="&");var n="uploadForm_"+e,e=$('<form id="'+n+'" enctype="multipart/form-data"  method="post"  target="'+m+'" action="'+k+t+"q="+e+"&rad="+Math.random()+'"   style=" display:none;"><input name="upload" type="text" value="1" /><input name="btnSubmit" id="btnSubmit" type="submit" value="Click" /></form>');e.append(b);$("body").append(e);0==r?0<l.children().length?l.children().eq(0).before(h):l.html(h):l.after(h);$("#"+n).find("#btnSubmit").click();$("#"+n).remove();b=function(){KD.Animate.LoadingSet.loadEnd("right");var a=this.contentWindow.document.body.innerText,b={};try{b=$.parseJSON(a)}catch(c){$(this).remove(),p(a)}(KD.isNull(b)||KD.isNull(b.id))&&p(a);console.log(b);g.Back(b)};e=f[0];e.attachEvent?e.attachEvent("onload",b):e.onload=b;KD.Animate.LoadingSet.loadStart("right");b="";b=d.flag?c+"":"#"+c;$(b).bind("change",{index:c,ObjIds:a.data.ObjIds},q)}var g=this.KDUpload={},k=null,p=function(a,c){KD.showWarning("\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25\uff01")};g.Back=function(a){switch(a.result.toLowerCase()){case"notype":alert("\u4e0d\u652f\u6301\u8be5\u7c7b\u578b\u6587\u4ef6\uff01");break;case"tomax":alert("\u8bf7\u4e0a\u4f20\u5c0f\u4e8e500kb\u7684\u6587\u4ef6\uff01");break;case"success":$("[data-bindId='"+a.id+"']").text(a.name);$("a[data-bindId='"+a.id+"']").attr("href",a.name);$("input[data-bindId='"+a.id+"']").val(a.name);$("img[data-bindId='"+a.id+"']").attr("src",a.path).attr("data-pic",a.name);break;default:alert("\u672a\u77e5\u9519\u8bef\uff0c\u8bf7\u91cd\u65b0\u5237\u65b0\u9875\u9762\u8fdb\u884c\u4e0a\u4f20\uff01")}KD.isFunc(k)&&k(a)};g.Success=function(a){k=a;return g};g.Error=function(a){p=a;return g};g.BinderUpload=function(a){for(var c in a){var d="",d=a[c].flag?c+"":"#"+c;$(d).bind("change",{index:c,ObjIds:a},q)}return g}})(window);